{% extends "!page.html" %}

{% block extrahead %}
  {{ super() }}
  {% if meta %}
    {% if meta.get('date') %}
      <meta name="article-date" content="{{ meta.get('date') }}" />
    {% endif %}
    {% if meta.get('author') %}
      <meta name="article-author" content="{{ meta.get('author') }}" />
    {% endif %}
  {% endif %}
  <meta name="github-user" content="{{ github_user }}" />
  <meta name="github-repo" content="{{ github_repo }}" />
  <meta name="github-branch" content="{{ github_version }}" />
  <meta name="doc-path" content="{{ doc_path }}" />
  <meta name="page-name" content="{{ pagename }}" />
{% endblock %}

{% block article %}
  {{ super() }}
{% endblock %}

{% block docs_body %}
  {{ super() }}
  
  {# Giscus Comments Section - only show if comment: True in front matter #}
  {% if meta and meta.get('comment') %}
  <article class="bd-article">
    <div class="giscus-container" style="margin-top: 2rem;">
      <div class="giscus-header">
        <span class="giscus-title">Comments ðŸ’¬</span>
        <span class="giscus-stats">
          <span id="giscus-comment-count">0 comments</span>,
          <span id="giscus-reaction-count">0 reactions</span>
          <span id="giscus-reactions"></span>
          â€” <a href="https://giscus.app" target="_blank" rel="noopener noreferrer">powered by giscus</a>
        </span>
      </div>
      <script src="https://giscus.app/client.js"
              data-repo="way2ml/comments"
              data-repo-id="R_kgDOGRwKvQ"
              data-category="General"
              data-category-id="DIC_kwDOGRwKvc4ChuA7"
              data-mapping="pathname"
              data-strict="0"
              data-reactions-enabled="1"
              data-emit-metadata="1"
              data-input-position="top"
              data-theme="preferred_color_scheme"
              data-lang="en"
              data-loading="lazy"
              crossorigin="anonymous"
              async>
      </script>
      <script>
        window.addEventListener('message', function(event) {
          if (event.origin !== 'https://giscus.app') return;
          if (!(typeof event.data === 'object' && event.data.giscus)) return;
          
          var giscusData = event.data.giscus;
          if ('discussion' in giscusData) {
            var discussion = giscusData.discussion;
            
            // Update comment count
            var commentCount = discussion.totalCommentCount || 0;
            var commentEl = document.getElementById('giscus-comment-count');
            if (commentEl) {
              commentEl.textContent = commentCount + (commentCount === 1 ? ' comment' : ' comments');
            }
            
            // Update reaction count and icons
            var reactions = discussion.reactions || {};
            var totalReactions = reactions.totalCount || 0;
            var reactionCountEl = document.getElementById('giscus-reaction-count');
            if (reactionCountEl) {
              reactionCountEl.textContent = totalReactions + (totalReactions === 1 ? ' reaction' : ' reactions');
            }
            
            // Show reaction icons
            var reactionsEl = document.getElementById('giscus-reactions');
            if (reactionsEl && reactions) {
              var icons = [];
              if (reactions.THUMBS_UP > 0) icons.push('ðŸ‘' + reactions.THUMBS_UP);
              if (reactions.THUMBS_DOWN > 0) icons.push('ðŸ‘Ž' + reactions.THUMBS_DOWN);
              if (reactions.LAUGH > 0) icons.push('ðŸ˜„' + reactions.LAUGH);
              if (reactions.HOORAY > 0) icons.push('ðŸŽ‰' + reactions.HOORAY);
              if (reactions.CONFUSED > 0) icons.push('ðŸ˜•' + reactions.CONFUSED);
              if (reactions.HEART > 0) icons.push('â¤ï¸' + reactions.HEART);
              if (reactions.ROCKET > 0) icons.push('ðŸš€' + reactions.ROCKET);
              if (reactions.EYES > 0) icons.push('ðŸ‘€' + reactions.EYES);
              reactionsEl.textContent = icons.length > 0 ? ' ' + icons.join(' ') : '';
            }
          }
        });
      </script>
    </div>
  </article>
  {% endif %}
{% endblock %}

{% block breadcrumbs %}{% endblock %}
